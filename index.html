<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Melbourne Tram – Map & Day-Type Chart</title>

  <!-- Vega stack -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    body{margin:0;padding:30px;background:#fafcff;font-family:Lato,Arial,sans-serif}
    .vis{max-width:850px;margin:0 auto 60px}
    h2{color:#2977d2;margin:.3em 0}
    .caption{color:#555;text-align:center;font-size:1.05em;margin-top:.7em}
  </style>
</head>
<body>

<!-- ──────────────── 1. Zoomable map ──────────────── -->
<div class="vis">
  <h2>Melbourne Tram Tracks</h2>
  <div id="map"></div>
  <p class="caption">
    <span style="color:#888">Grey = Australia outline</span> &nbsp;|&nbsp;
    <span style="color:#ff9800"><b>Orange = Tram lines</b></span>
  </p>
</div>

<!-- ─────────────── 2. Day-type bar chart ─────────── -->
<div class="vis">
  <h2>Average Passengers per Day-type (select month)</h2>
  <div id="bars"></div>
</div>

<script>
/* ============================================================ */
/* 1)  ZOOMABLE MAP SPEC  (unchanged except wrapper id)          */
/* ============================================================ */
const mapSpec = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":700,"height":700,

  "params":[
    {
      "name":"zoom",
      "value":250000,
      "bind":{
        "input":"range","min":100000,"max":800000,"step":10000,
        "name":"Zoom: "
      }
    }
  ],

  "layer":[
    /* Australia */
    {
      "data":{
        "url":"https://raw.githubusercontent.com/jken0043/3179/633cde8656cab115add65a781e0578432082ea7b/au.json",
        "format":{"type":"topojson","feature":"collection"}
      },
      "mark":{"type":"geoshape","fill":"#e0e0e0","stroke":"#999","strokeWidth":1.2}
    },
    /* Tram lines */
    {
      "data":{
        "url":"https://raw.githubusercontent.com/jken0043/3179/main/tram-lines.json",
        "format":{"type":"json","property":"features"}
      },
      "mark":{"type":"geoshape","stroke":"#ff9800","strokeWidth":2,"fill":null}
    }
  ],

  "projection":{
    "type":"mercator",
    "center":[144.9631,-37.8136],
    "scale":{"expr":"zoom"}
  },

  "config":{"view":{"stroke":null}}
};


/* =================  DAY-TYPE BAR CHART  ================ */
const barSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 350,

  /* ── sliders ── */
  "params": [
    {
      "name": "yearSel",  "value": 2018,
      "bind": { "input":"range","min":2018,"max":2025,"step":1,"name":"Year: " }
    },
    {
      "name": "monthSel", "value": 1,
      "bind": {
        "input":"select",
        "options":[1,2,3,4,5,6,7,8,9,10,11,12],
        "labels":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
        "name":"Month: "
      }
    }
  ],

  "data": {
    "url": "https://raw.githubusercontent.com/jken0043/3179/763cbecb78a05befb6cea9d52b3ad8d19d191eb2/d49915dc-98ac-45d1-afd8-3aea823ce292.csv",
    "format": { "type": "csv" }
  },

  "transform": [
    { "filter": "datum.Mode === 'Tram'" },
    { "calculate": "toNumber(datum.Year)",  "as": "YearNum"  },
    { "calculate": "toNumber(datum.Month)", "as": "MonthNum" },
    { "filter": "datum.YearNum == yearSel && datum.MonthNum == monthSel" }
  ],

  "mark": "bar",

  "encoding": {
    "x": {
      "field": "Day_type", "type": "nominal",
      "title": "Day type",
      "sort": ["Normal Weekday","School Holiday Weekday","Weekend"]
    },
    "y": {
      "field": "Pax_daily",
      "type": "quantitative",
      "title": "Average passengers",
      "axis": { "format": ",d" }    // ← was ","  ➜ now ",d"
    },
    "color": {
      "field": "Day_type", "type": "nominal", "legend": null,
      "scale": {
        "domain":["Normal Weekday","School Holiday Weekday","Weekend"],
        "range":["#ff9800","#1976d2","#7b1fa2"]
      }
    },
    "tooltip": [
      {"field":"Day_type","title":"Day type"},
      {"field":"Pax_daily","title":"Passengers","format":","},
      {"field":"Year","title":"Year"},
      {"field":"Month_name","title":"Month"}
    ]
  },

  "config": { "view": { "stroke": null } }
};


/* embed both charts */
vegaEmbed("#map",  mapSpec, {actions:false});
vegaEmbed("#bars", barSpec, {actions:false});
</script>
</body>
</html>
