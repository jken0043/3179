<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="style.css">
  <meta charset="utf-8" />
  <title>Melbourne Tram – Map & Day-Type Chart</title>

  <!-- Vega stack -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    body{margin:0;padding:30px;background:#fafcff;font-family:Lato,Arial,sans-serif}
    .vis{max-width:850px;margin:0 auto 60px}
    h2{color:#2977d2;margin:.3em 0}
    .caption{color:#555;text-align:center;font-size:1.05em;margin-top:.7em}
  </style>
</head>
<body>

<body>
  <div class="container">
    <h1>Riding Through the City: Melbourne’s Tram Network and Commuter Patterns</h1>

    <!-- Introductory text -->
    <p class="intro">
      Melbourne’s tram network is one of the world’s largest and most iconic. 
      This visualisation explores how the tram lines spread across the city, 
      how daily passenger volumes vary by day type, and how travel trends change 
      throughout the year. Use the interactive charts below to uncover patterns 
      in public transport usage across different months and weekdays.
    </p>

    <!-- 1. Zoomable map -->
    <div class="vis">
      <h2>Melbourne City Tram Network Over Street Map</h2>
      <div id="map"></div>
      <p class="caption">
        <span style="color:#888">Grey = Melbourne city outline</span> |
        <span style="color:#ff9800"><b>Orange = Tram lines</b></span>
      </p>
    </div>

    <p class="intro">
      Melbourne’s tram network forms the backbone of the city’s public transport system. 
      This map highlights the extensive network of tram routes stretching across the metropolitan area. 
      The orange lines represent tram tracks, while the grey background outlines the city’s street layout. 
      Together, they show how trams connect key suburbs and commercial areas, particularly around the CBD, 
      making Melbourne one of the world’s most connected tram cities.
    </p>

    <!-- 2. Bar chart -->
    <div class="vis">
      <h2 class="chart-title">Average Tram Passenger Volume by Day Type</h2>
      <p class="chart-subtitle">Use the controls below to explore different months and years</p>
      <div id="bars"></div>
    </div>

    <p class="intro">
      This chart compares the average number of daily tram passengers across different day types — 
      normal weekdays, school holiday weekdays, and weekends. By adjusting the sliders below, 
      you can explore how travel patterns vary between months and years. The data reveals how 
      weekday commuter traffic dominates Melbourne’s tram usage, while weekends show a clear drop 
      in passenger volumes as leisure travel replaces daily commuting.
    </p>

    <!-- 3. Line trend chart -->
    <div class="vis">
      <h2 class="chart-title">Monthly Passenger Trend by Day Type</h2>
      <p class="chart-subtitle">Drag the slider to explore monthly passenger trends for each year</p>
      <div id="trend"></div>
    </div>

    <p class="intro">
      This line chart tracks how average tram passenger numbers change throughout the year, 
      separated by day type. Each line represents a different pattern of travel demand — 
      normal weekdays, school holiday weekdays, and weekends. The slider below lets you 
      explore how seasonal changes, public holidays, and school terms influence tram usage 
      across different years. Notice how weekday travel peaks early in the year and dips 
      during mid-year holidays, while weekend travel remains relatively stable throughout.
    </p>

    <!-- 4. References -->
    <div class="vis">
      <h2>References</h2>
      <ul class="references">
        <li>
          <b>Images:</b>
          <a href="https://commons.wikimedia.org/wiki/File:B2-class_Melbourne_tram_interior,_2013.JPG" target="_blank">
            Wikimedia Commons – B2-class Melbourne tram interior (2013)
          </a>
        </li>
        <li>
          <b>Tram lines:</b>
          <a href="https://data.melbourne.vic.gov.au/explore/dataset/tram-tracks/information/" target="_blank">
            City of Melbourne Open Data – Tram Tracks Dataset
          </a>
        </li>
        <li>
          <b>Tram user data:</b>
          <a href="https://opendata.transport.vic.gov.au/dataset/monthly-average-patronage-by-day-type-and-by-mode/resource/d49915dc-98ac-45d1-afd8-3aea823ce292?filters=Mode%3ATram" target="_blank">
            Victorian Government Open Data – Monthly Average Patronage by Mode
          </a>
        </li>
        <li>
          <b>Melbourne city map:</b>
          <a href="https://overpass-turbo.eu/#" target="_blank">
            OpenStreetMap / Overpass Turbo Export
          </a>
        </li>
      </ul>
    </div>
  </div>
</body>


<script>
/* =============== ZOOMABLE MAP SPEC  (unchanged except wrapper id) ===============*/
const mapSpec = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":700,"height":700,

  "params":[
    {
      "name":"zoom",
      "value":400000,
      "bind":{
        "input":"range","min":400000,"max":800000,"step":10000,
        "name":"Zoom: "
      }
    }
  ],

  "layer":[
    /* Melbourne Base Map */
    {
      "data": {
        "url": "https://raw.githubusercontent.com/jken0043/3179/c525f9820e94b547b0d90bb3f21b97edc4f84ef5/melbourne_city.json",
        "format": { "type": "json" }
      },
      "mark": {
        "type": "geoshape",
        "fill": "#cccccc",
        "stroke": "#999",
        "strokeWidth": 1.2
      }
    },
    /* Tram lines */
    {
      "data":{
        "url":"https://raw.githubusercontent.com/jken0043/3179/main/tram-lines.json",
        "format":{"type":"json","property":"features"}
      },
      "mark":{"type":"geoshape","stroke":"#ff9800","strokeWidth":2,"fill":null}
    }
  ],

  "projection":{
    "type":"mercator",
    "center":[144.9631,-37.8136],
    "scale":{"expr":"zoom"}
  },

  "config":{"view":{"stroke":null}}
};


/* =================  DAY-TYPE BAR CHART  ================ */
const barSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 650,
  "height": 380,

  /* ── interactive controls ── */
  "params": [
    {
      "name": "yearSel",
      "value": 2018,
      "bind": { 
        "input": "range",
        "min": 2018, "max": 2025, "step": 1,
        "name": "Year: "
      }
    },
    {
      "name": "monthSel",
      "value": 1,
      "bind": {
        "input": "select",
        "options": [1,2,3,4,5,6,7,8,9,10,11,12],
        "labels": ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
        "name": "Month: "
      }
    }
  ],

  /* ── dataset ── */
  "data": {
    "url": "https://raw.githubusercontent.com/jken0043/3179/763cbecb78a05befb6cea9d52b3ad8d19d191eb2/d49915dc-98ac-45d1-afd8-3aea823ce292.csv",
    "format": { "type": "csv" }
  },

  /* ── filters & calculations ── */
  "transform": [
    { "filter": "datum.Mode === 'Tram'" },
    { "calculate": "toNumber(datum.Year)",  "as": "YearNum" },
    { "calculate": "toNumber(datum.Month)", "as": "MonthNum" },
    { "filter": "datum.YearNum == yearSel && datum.MonthNum == monthSel" }
  ],

  /* ── visual encoding ── */
  "mark": {
    "type": "bar",
    "cornerRadiusTopLeft": 6,
    "cornerRadiusTopRight": 6,
    "stroke": null,
    "strokeWidth": 0
  },

  "encoding": {
    "x": {
      "field": "Day_type",
      "type": "nominal",
      "title": "Day Type",
      "sort": ["Normal Weekday","School Holiday Weekday","Weekend"],
      "axis": { "labelAngle": 0, "labelFontSize": 12, "titleFontWeight": "bold" }
    },
    "y": {
      "aggregate": "mean",            
      "field": "Pax_daily",
      "type": "quantitative",
      "title": "Average Daily Passenger Count",
      "axis": { "format": ",d", "titleFontWeight": "bold", "grid": false }
    },
    "color": {
      "field": "Day_type",
      "type": "nominal",
      "title": "Day Type",            
      "legend": {
        "orient": "right",            
        "titleFontWeight": "bold",
        "labelFontSize": 12,
        "titleFontSize": 13
      },
      "scale": {
        "domain": ["Normal Weekday","School Holiday Weekday","Weekend"],
        "range": ["#f9a825","#2196f3","#e53935"]
      }
    },

    "tooltip": [
      {"field": "Day_type", "title": "Day Type"},
      {"field": "Pax_daily", "title": "Average Passengers", "format": ","},
      {"field": "Year", "title": "Year"},
      {"field": "Month_name", "title": "Month"}
    ]
  },

  /* ── layout & style ── */
  "title": {
    "subtitle": "Use the controls below to explore different months and years",
    "fontSize": 20,
    "fontWeight": "bold",
    "anchor": "start",
    "color": "#1565c0"
  },

  "config": {
    "view": { "stroke": null },
    "axis": {
      "labelFont": "Lato",
      "titleFont": "Lato"
    }
  }
};

/* =================  MONTHLY LINE TREND CHART  ================ */
const lineSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 650,
  "height": 380,

  /* ── interactive controls ── */
  "params": [
    {
      "name": "yearSel",
      "value": 2018,
      "bind": { 
        "input": "range",
        "min": 2018, "max": 2025, "step": 1,
        "name": "Year: "
      }
    }
  ],

  /* ── dataset ── */
  "data": {
    "url": "https://raw.githubusercontent.com/jken0043/3179/c525f9820e94b547b0d90bb3f21b97edc4f84ef5/d49915dc-98ac-45d1-afd8-3aea823ce292.csv",
    "format": { "type": "csv" }
  },

  /* ── filters & calculations ── */
  "transform": [
    { "filter": "datum.Mode === 'Tram'" },
    { "calculate": "toNumber(datum.Year)",  "as": "YearNum" },
    { "calculate": "toNumber(datum.Month)", "as": "MonthNum" },
    { "filter": "datum.YearNum == yearSel" },
    {
      "aggregate": [
        { "op": "mean", "field": "Pax_daily", "as": "Avg_Pax" }
      ],
      "groupby": ["YearNum", "MonthNum", "Day_type"]
    }
  ],

  /* ── visual encoding ── */
  "mark": {
    "type": "line",
    "point": true,
    "strokeWidth": 3
  },

  "encoding": {
    "x": {
      "field": "MonthNum",
      "type": "ordinal",
      "title": "Month",
      "axis": {
        "values": [1,2,3,4,5,6,7,8,9,10,11,12],
        "labelExpr": "['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][datum.value - 1]",
        "labelFontSize": 12,
        "titleFontWeight": "bold"
      }
    },
    "y": {
      "field": "Avg_Pax",
      "type": "quantitative",
      "title": "Average Daily Passengers",
      "axis": { "format": ",d", "titleFontWeight": "bold", "grid": false }
    },
    "color": {
      "field": "Day_type",
      "type": "nominal",
      "title": "Day Type",
      "scale": {
        "domain": ["Normal Weekday","School Holiday Weekday","Weekend"],
        "range": ["#f9a825","#2196f3","#e53935"]
      }
    },
    "tooltip": [
      { "field": "Day_type", "title": "Day Type" },
      { "field": "YearNum", "title": "Year" },
      { "field": "Avg_Pax", "title": "Average Passengers", "format": "," }
    ]
  },

  /* ── layout & style ── */
  "title": {
    "subtitle": "Drag the slider to explore monthly passenger trends for each year",
    "fontSize": 20,
    "fontWeight": "bold",
    "anchor": "start",
    "color": "#1565c0"
  },

  "config": {
    "view": { "stroke": null },
    "axis": {
      "labelFont": "Lato",
      "titleFont": "Lato"
    }
  }
};


/* embed both charts */
vegaEmbed("#map",  mapSpec, {actions:false});
vegaEmbed("#bars", barSpec, {actions:false});
vegaEmbed("#trend", lineSpec, {actions:false});
</script>
</body>
</html>
